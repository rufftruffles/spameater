[supervisord]
nodaemon=true
logfile=/opt/spameater/logs/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/opt/spameater/logs

[program:nginx]
command=nginx -g "daemon off;"
autostart=true
autorestart=true
priority=100
stdout_logfile=/opt/spameater/logs/nginx-stdout.log
stderr_logfile=/opt/spameater/logs/nginx-stderr.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=1
stderr_logfile_backups=1

[program:haraka]
command=/bin/bash -c "source /opt/spameater/.env && exec /usr/local/bin/haraka -c /opt/spameater/haraka"
directory=/opt/spameater/haraka
user=spameater
autostart=true
autorestart=true
priority=200
stdout_logfile=/opt/spameater/logs/haraka.log
stderr_logfile=/opt/spameater/logs/haraka-error.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=2
stderr_logfile_backups=2

[program:spameater-api]
command=/bin/bash -c "source /opt/spameater/.env && exec /usr/bin/node /opt/spameater/api-server.js"
directory=/opt/spameater
user=spameater
autostart=true
autorestart=true
priority=200
stdout_logfile=/opt/spameater/logs/api.log
stderr_logfile=/opt/spameater/logs/api-error.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=2
stderr_logfile_backups=2

[program:crond]
command=crond -n
autostart=true
autorestart=true
priority=300
stdout_logfile=/opt/spameater/logs/cron.log
stderr_logfile=/opt/spameater/logs/cron-error.log
stdout_logfile_maxbytes=1MB
stderr_logfile_maxbytes=1MB

[program:fail2ban]
command=fail2ban-server -f
autostart=true
autorestart=false
priority=400
stdout_logfile=/opt/spameater/logs/fail2ban.log
stderr_logfile=/opt/spameater/logs/fail2ban-error.log
stdout_logfile_maxbytes=5MB
stderr_logfile_maxbytes=5MB
# Note: fail2ban may not work properly in containers without privileged mode

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface
